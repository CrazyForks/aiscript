## Define model

Model is the core concept of AiScript. It is a class that represents a table in the database. It is defined by the `model` keyword, mapping to a table in the database.

```py
@table(name="user")
model User {
    @primary
    id: int
    handle: str
    nickname: str
    email: str
    password: str
    gender: str
    avatar: str
    bio: str
    follow_count: int
    follower_count: int
    tweet_count: int
    created_at: datetime
    updated_at: datetime
}
```

You can use `@table` to specify the table name. If not specified, the table name will be the same as the model name.

## Define query methods

`with` block is used to define query methods. The syntax is:

```py
with ModelName {
    auto fn method_name1(arg1: type1, arg2: type2, ...) -> return_type

    fn method_name2(arg1: type1, arg2: type2, ...) -> return_type {
        ...
    }
}
```

There are two types of methods:

- Auto method: The method is automatically generated by AiScript under some conventions. Auto methods are marked with `auto` keyword, and function block is omitted.
- Normal method: The method is defined by the user. It required to write the SQL statement by yourself and cannot be empty.

```py
with User {
    auto fn get_by_id(id: int) -> User

    auto fn get_by_handle(handle: str) -> User

    fn create(handle: str, nickname: str, email: str, password: str) -> User {
        # for brevity, we don't encrypt the password here
        return sql {
            INSERT INTO user (handle, nickname, email, password)
            VALUES (:handle, :nickname, :email, :password RETURNING *
        }
    }
}
```

After defining the model, you can use the model in the [route](./route.md) to query the database. However, every model should prefix with `model.`, this is the AiScript [philosophy](../philosophy.md).

```py
get /tweet/<id: int> {
    return model.Tweet.get_by_id(id)
}
```

## Return schema

In most case, you don't want to return the all fields to the client, especially the password field. You can use `schema` as the return type to specify the fields you want to return.

```py
# schemas/user.ai

schema UserInfo {
    id: int
    handle: str
    nickname: str
    avatar: str
    bio: str
}

# models/user.ai

with User {
    fn get_by_id(id: int) -> schema.UserInfo

    auto fn get_by_handle(handle: str) -> schema.UserInfo

    fn create(handle: str, nickname: str, email: str, password: str) -> schema.UserInfo {
        # for brevity, we don't encrypt the password here
        return sql { 
            INSERT INTO user (handle, nickname, email, password)
            VALUES (:handle, :nickname, :email, :password) RETURNING *
        }
    }
}
```

Same as `model`, all schema should prefix with `schema.`, you know, this is the AiScript [philosophy](../philosophy.md). For more details, please refer to [schema](./schema.md).
