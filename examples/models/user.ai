@table(name="user")
model User {
    @primary
    id: int
    handle: str
    nickname: str
    email: str
    password: str
    gender: str
    avatar: str
    bio: str
    follow_count: int
    follower_count: int
    tweet_count: int
    created_at: datetime
    updated_at: datetime
}

with User {
    @one_to_many(model.Tweet, user_id)
    tweets: [schema.Tweet]

    auto fn get_by_id(id: int) -> User
    
    auto fn get_by_handle(handle: str) -> User

    auto fn check_unique_handle(handle: str) -> bool

    fn create(handle: str, nickname: str, email: str, password: str) -> User {
        # for brevity, we don't encrypt the password here
        return sql {
            INSERT INTO user (handle, nickname, email, password) 
            VALUES (:handle, :nickname, :email, :password)
            RETURNING *
        }
    }

    fn update(nickname: str, avatar: str, bio: str) -> User {
        return sql {
            UPDATE user SET nickname = :nickname, avatar = :avatar, bio = :bio
            WHERE id = :user_id RETURNING *
        }
    }
}